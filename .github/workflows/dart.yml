name: Dart
on: pull_request

jobs:
  packages:
    strategy:
      matrix:
        package:
          - ferry
          - ferry_cache
          - ferry_exec
          - ferry_generator
          - ferry_hive_store
          - ferry_store
          - normalize
    runs-on: ubuntu-latest
    container:
      image: google/dart:latest
    name: Check ${{ matrix.package }}
    env:
      PACKAGE: ${{ matrix.package }}
    steps:
      - name: Clone repository
        uses: actions/checkout@v2
      - name: Activate melos
        run: |
          echo "$HOME/.pub-cache/bin" >> $GITHUB_PATH
          pub global activate melos
      - name: Bootstrap melos
        run: |
          melos bs
      - name: Analyze package
        run: |
          melos exec --scope=$PACKAGE -- dart analyze
      - name: Run tests
        run: |
          melos exec --scope=$PACKAGE -- dart test
